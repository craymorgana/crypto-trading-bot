<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Scalping Bot - Trading Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 5px solid #00ff88;
        }

        h1 {
            color: #00ff88;
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .status {
            display: inline-block;
            padding: 5px 15px;
            background: #00ff88;
            color: #1a1a2e;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .card:hover {
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
        }

        .card-title {
            color: #00ff88;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .card-value {
            font-size: 2em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .card-subtext {
            color: #999;
            font-size: 0.85em;
        }

        .positive {
            color: #00ff88;
        }

        .negative {
            color: #ff4444;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            color: #00ff88;
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #00ff88;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.1);
        }

        tr:hover {
            background: rgba(0, 255, 136, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-bullish {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .badge-bearish {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }

        .badge-open {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .badge-closed {
            background: rgba(100, 100, 100, 0.3);
            color: #999;
        }

        .indicators {
            display: flex;
            gap: 5px;
            font-size: 0.75em;
            margin-top: 5px;
        }

        .indicator {
            padding: 3px 8px;
            background: rgba(0, 255, 136, 0.15);
            border-radius: 3px;
            color: #00ff88;
        }

        .confidence-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6e);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 5px;
            color: #1a1a2e;
            font-size: 0.75em;
            font-weight: bold;
        }

        .no-data {
            text-align: center;
            padding: 30px;
            color: #666;
            font-style: italic;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 6px;
            border-left: 3px solid #00ff88;
        }

        .stat-label {
            color: #888;
            font-size: 0.85em;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
        }

        .refresh-info {
            text-align: center;
            color: #666;
            font-size: 0.85em;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 255, 136, 0.1);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .updating {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Crypto Scalping Bot</h1>
            <p>Live Paper Trading Dashboard</p>
            <div class="status">‚óè LIVE MONITORING</div>
        </header>

        <!-- Performance Metrics -->
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-label">Total Balance</div>
                <div class="stat-number" id="currentBalance">$0.00</div>
                <div class="stat-label" style="color: #00ff88; margin-top: 5px;" id="totalReturn">+0.00%</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total P&L</div>
                <div class="stat-number" id="totalProfitLoss">$0.00</div>
                <div class="stat-label">Win Rate: <span id="winRate">0%</span></div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Trades</div>
                <div class="stat-number" id="totalTrades">0</div>
                <div class="stat-label">Wins: <span id="totalWins">0</span> | Losses: <span id="totalLosses">0</span></div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Open Positions</div>
                <div class="stat-number" id="openPositions">0</div>
                <div class="stat-label" id="lastUpdate">Last update: Never</div>
            </div>
        </div>

        <!-- Open Positions -->
        <div class="section">
            <div class="section-title">üìà Open Positions</div>
            <table id="openPositionsTable">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Signal</th>
                        <th>Entry Price</th>
                        <th>Stop Loss</th>
                        <th>Target</th>
                        <th>Confidence</th>
                        <th>Indicators</th>
                    </tr>
                </thead>
                <tbody id="openPositionsBody">
                    <tr><td colspan="7" class="no-data">No open positions</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Closed Trades -->
        <div class="section">
            <div class="section-title">‚úÖ Recent Closed Trades</div>
            <table id="closedTradesTable">
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Signal</th>
                        <th>Entry Price</th>
                        <th>Exit Price</th>
                        <th>P&L</th>
                        <th>Return %</th>
                        <th>Reason</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="closedTradesBody">
                    <tr><td colspan="8" class="no-data">No closed trades yet</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Signals -->
        <div class="section">
            <div class="section-title">üéØ Recent Signals</div>
            <table id="signalsTable">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Signal</th>
                        <th>Confidence</th>
                        <th>Pattern</th>
                        <th>Indicators</th>
                        <th>Fib/Harmonics</th>
                    </tr>
                </thead>
                <tbody id="signalsBody">
                    <tr><td colspan="6" class="no-data">No signals yet</td></tr>
                </tbody>
            </table>
        </div>

        <div class="refresh-info">
            üì° Dashboard updates every 2 seconds | Data refreshed at: <span id="refreshTime">--:--:--</span>
        </div>
    </div>

    <script>
        const API_BASE = '/api';
        const REFRESH_INTERVAL = 2000; // 2 seconds

        // Format currency
        function formatCurrency(num) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(num);
        }

        // Format percentage
        function formatPercent(num) {
            const sign = num >= 0 ? '+' : '';
            return `${sign}${num.toFixed(2)}%`;
        }

        // Format time
        function formatTime(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleTimeString();
        }

        // Update dashboard
        async function updateDashboard() {
            try {
                const response = await fetch(`${API_BASE}/data`);
                const data = await response.json();

                // Update stats
                const stats = data.stats;
                document.getElementById('currentBalance').textContent = formatCurrency(stats.currentBalance);
                document.getElementById('totalReturn').textContent = formatPercent(stats.totalReturn);
                document.getElementById('totalProfitLoss').textContent = formatCurrency(stats.totalProfitLoss);
                document.getElementById('winRate').textContent = stats.winRate + '%';
                document.getElementById('totalTrades').textContent = stats.totalTrades;
                document.getElementById('totalWins').textContent = stats.totalWins;
                document.getElementById('totalLosses').textContent = stats.totalLosses;
                document.getElementById('openPositions').textContent = stats.openPositions;
                document.getElementById('lastUpdate').textContent = `Last update: ${new Date().toLocaleTimeString()}`;
                document.getElementById('refreshTime').textContent = new Date().toLocaleTimeString();

                // Update color based on P&L
                const plElement = document.getElementById('totalProfitLoss');
                plElement.className = stats.totalProfitLoss >= 0 ? 'positive' : 'negative';
                const returnElement = document.getElementById('totalReturn');
                returnElement.className = stats.totalReturn >= 0 ? 'positive' : 'negative';

                // Update open positions
                updateOpenPositions(data.trades);

                // Update closed trades
                updateClosedTrades(data.trades);

                // Update signals
                updateSignals(data.signals);

            } catch (err) {
                console.error('Error updating dashboard:', err);
            }
        }

        function updateOpenPositions(trades) {
            const openTrades = trades.filter(t => t.status === 'OPEN');
            const tbody = document.getElementById('openPositionsBody');

            if (openTrades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-data">No open positions</td></tr>';
                return;
            }

            tbody.innerHTML = openTrades.map(trade => {
                const indicators = [trade.pattern, trade.indicators].filter(Boolean).join(', ');
                return `
                    <tr>
                        <td>${trade.symbol}</td>
                        <td><span class="badge ${trade.signal === 'BULLISH' ? 'badge-bullish' : 'badge-bearish'}">${trade.signal}</span></td>
                        <td>$${trade.entryPrice.toFixed(2)}</td>
                        <td>$${trade.stopPrice.toFixed(2)}</td>
                        <td>$${trade.targetPrice.toFixed(2)}</td>
                        <td>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${trade.confidence}%">
                                    ${trade.confidence}%
                                </div>
                            </div>
                        </td>
                        <td><span class="indicator">${indicators || 'N/A'}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function updateClosedTrades(trades) {
            const closedTrades = trades
                .filter(t => t.status === 'CLOSED')
                .sort((a, b) => new Date(b.exitTime) - new Date(a.exitTime))
                .slice(0, 15);

            const tbody = document.getElementById('closedTradesBody');

            if (closedTrades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="no-data">No closed trades yet</td></tr>';
                return;
            }

            tbody.innerHTML = closedTrades.map(trade => {
                const profitClass = trade.profitLoss >= 0 ? 'positive' : 'negative';
                return `
                    <tr>
                        <td>${trade.symbol}</td>
                        <td><span class="badge ${trade.signal === 'BULLISH' ? 'badge-bullish' : 'badge-bearish'}">${trade.signal}</span></td>
                        <td>$${trade.entryPrice.toFixed(2)}</td>
                        <td>$${trade.exitPrice.toFixed(2)}</td>
                        <td class="${profitClass}">$${trade.profitLoss.toFixed(2)}</td>
                        <td class="${profitClass}">${formatPercent(trade.profitLossPercent)}</td>
                        <td>${trade.reason}</td>
                        <td>${formatTime(trade.exitTime)}</td>
                    </tr>
                `;
            }).join('');
        }

        function updateSignals(signals) {
            const recentSignals = signals
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                .slice(0, 20);

            const tbody = document.getElementById('signalsBody');

            if (recentSignals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">No signals yet</td></tr>';
                return;
            }

            tbody.innerHTML = recentSignals.map(signal => {
                const indicatorsList = [
                    signal.indicators?.signal,
                    signal.fibonacci ? 'Fib' : null,
                    signal.harmonics ? 'Harmonics' : null
                ].filter(Boolean).join(', ');

                return `
                    <tr>
                        <td>${formatTime(signal.timestamp)}</td>
                        <td><span class="badge ${signal.signal === 'BULLISH' ? 'badge-bullish' : 'badge-bearish'}">${signal.signal}</span></td>
                        <td>
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${signal.confidence}%">
                                    ${signal.confidence}%
                                </div>
                            </div>
                        </td>
                        <td>${signal.pattern || 'N/A'}</td>
                        <td><span class="indicator">${signal.indicators?.signal || 'N/A'}</span></td>
                        <td>${indicatorsList || 'N/A'}</td>
                    </tr>
                `;
            }).join('');
        }

        // Auto-refresh dashboard
        setInterval(updateDashboard, REFRESH_INTERVAL);

        // Initial load
        updateDashboard();
    </script>
</body>
</html>
